# データモデル

## 変更履歴

| バージョン | 日付 | 変更内容 |
|-----------|------|---------|
| 1.2 | 2025-11-27 | startDate, endDate を必須項目に変更 |
| 1.1 | 2025-11-27 | startDate, endDate, progress フィールドを追加。進捗状況とステータスの同期ロジックを追加 |
| 1.0 | 2024-11-26 | 初版作成 |

## 1. エンティティ一覧

| エンティティ名 | 説明 | ファイル |
|---------------|------|---------|
| Task | タスク | backend/src/models/Task.ts |

## 2. Task エンティティ

### 2.1 フィールド定義

| フィールド名 | 型 | 必須 | デフォルト | 説明 |
|-------------|------|------|-----------|------|
| id | number | 自動 | 自動採番 | タスクの一意識別子 |
| title | string | ○ | - | タスク名（1〜100文字） |
| description | string | - | 空文字 | タスクの詳細説明（0〜500文字） |
| status | TaskStatus | 自動 | TODO | タスクの進捗状態 |
| startDate | Date | ○ | - | 開始日（YYYY-MM-DD形式） |
| endDate | Date | ○ | - | 終了日（YYYY-MM-DD形式） |
| progress | number | 自動 | 0 | 進捗状況（0/25/50/75/100のいずれか） |
| createdAt | Date | 自動 | 現在日時 | 作成日時 |
| updatedAt | Date | 自動 | 現在日時 | 最終更新日時 |

### 2.2 TypeScript型定義

```typescript
/**
 * タスクのデータモデル
 */
export interface Task {
  /** タスクID（自動採番） */
  id: number;

  /** タスク名 */
  title: string;

  /** タスクの詳細説明 */
  description: string;

  /** タスクのステータス */
  status: TaskStatus;

  /** 開始日 */
  startDate: Date;

  /** 終了日 */
  endDate: Date;

  /** 進捗状況（0/25/50/75/100） */
  progress: number;

  /** 作成日時 */
  createdAt: Date;

  /** 更新日時 */
  updatedAt: Date;
}
```

## 3. Enum定義

### 3.1 TaskStatus

タスクの進捗状態を表すEnum。

| 値 | 表示名 | 説明 |
|----|-------|------|
| TODO | 未着手 | タスクがまだ開始されていない |
| IN_PROGRESS | 進行中 | タスクが作業中 |
| DONE | 完了 | タスクが完了した |

```typescript
/**
 * タスクのステータスを表すEnum
 */
export enum TaskStatus {
  /** 未着手 */
  TODO = 'TODO',
  /** 進行中 */
  IN_PROGRESS = 'IN_PROGRESS',
  /** 完了 */
  DONE = 'DONE'
}
```

### 3.2 ステータス遷移

```
TODO → IN_PROGRESS → DONE
  ↑_________|_________|
  （任意のステータスに戻すことも可能）
```

## 4. リクエスト/レスポンス型

### 4.1 CreateTaskRequest

タスク作成時のリクエストデータ。

```typescript
/**
 * タスク作成時のリクエストデータ
 */
export interface CreateTaskRequest {
  title: string;       // 必須
  description: string; // 任意（空文字可）
  startDate: string;   // 必須（YYYY-MM-DD形式）
  endDate: string;     // 必須（YYYY-MM-DD形式）
  progress?: number;   // 任意（0/25/50/75/100、デフォルト: 0）
}
```

| フィールド | 型 | 必須 | バリデーション |
|-----------|------|------|--------------|
| title | string | ○ | 空文字不可、1〜100文字 |
| description | string | - | 0〜500文字 |
| startDate | string | ○ | YYYY-MM-DD形式 |
| endDate | string | ○ | YYYY-MM-DD形式 |
| progress | number | - | 0/25/50/75/100のいずれか、デフォルト: 0 |

### 4.2 UpdateTaskRequest

タスク更新時のリクエストデータ。全フィールドが任意。

```typescript
/**
 * タスク更新時のリクエストデータ
 */
export interface UpdateTaskRequest {
  title?: string;
  description?: string;
  status?: TaskStatus;
  startDate?: string;
  endDate?: string;
  progress?: number;
}
```

| フィールド | 型 | 必須 | バリデーション |
|-----------|------|------|--------------|
| title | string | - | 空文字不可（指定時）、1〜100文字 |
| description | string | - | 0〜500文字 |
| status | TaskStatus | - | Enum値のいずれか |
| startDate | string | - | YYYY-MM-DD形式 |
| endDate | string | - | YYYY-MM-DD形式 |
| progress | number | - | 0/25/50/75/100のいずれか |

## 5. バリデーションルール

### 5.1 title（タスク名）
- **必須チェック**: 作成時は必須
- **空文字チェック**: 空文字・空白のみは不可
- **最大文字数**: 100文字

### 5.2 description（詳細説明）
- **任意項目**: 空文字可
- **最大文字数**: 500文字

### 5.3 status（ステータス）
- **有効値チェック**: TaskStatusのEnum値のみ許可
- **デフォルト値**: TODO（作成時）

### 5.4 startDate（開始日）
- **必須項目**: 作成時は必須
- **形式**: YYYY-MM-DD形式の文字列

### 5.5 endDate（終了日）
- **必須項目**: 作成時は必須
- **形式**: YYYY-MM-DD形式の文字列
- **日付順序**: endDate < startDate も許可（検証なし）

### 5.6 progress（進捗状況）
- **有効値チェック**: 0, 25, 50, 75, 100 のいずれかのみ許可
- **デフォルト値**: 0（作成時）

### 5.7 進捗状況とステータスの同期ロジック

進捗状況（progress）とステータス（status）は常に双方向で同期されます。

#### 進捗 → ステータスの自動更新

| 進捗値 | 自動設定されるステータス |
|-------|---------------------|
| 0% | TODO（未着手） |
| 25% | IN_PROGRESS（進行中） |
| 50% | IN_PROGRESS（進行中） |
| 75% | IN_PROGRESS（進行中） |
| 100% | DONE（完了） |

#### ステータス → 進捗の自動更新

| ステータス | 自動設定される進捗 |
|-----------|----------------|
| TODO | 0% |
| IN_PROGRESS | 25% |
| DONE | 100% |

**実装上の注意点:**
- タスク作成時に progress のみ指定された場合、上記ルールに従って status が自動設定される
- タスク更新時に progress を変更した場合、status が自動的に同期される
- タスク更新時に status を変更した場合、progress が自動的に同期される
- progress と status の両方が同時に指定された場合、progress の値を優先し、それに基づいて status を設定する

## 6. データストレージ

### 6.1 ストレージ方式
- **方式**: インメモリ（配列）
- **永続化**: なし（サーバー再起動でデータ消失）

### 6.2 ID採番
- **方式**: 連番（1から開始）
- **実装**: `nextId` カウンター変数

```typescript
private tasks: Task[] = [];
private nextId: number = 1;
```

## 7. サンプルデータ

サーバー起動時に以下のサンプルデータが自動生成されます。

| id | title | description | status | startDate | endDate | progress |
|----|-------|-------------|--------|-----------|---------|----------|
| 1 | API仕様書を作成 | REST APIエンドポイントの仕様書をMarkdown形式で作成する | TODO | システム日付 | システム日付 | 0 |
| 2 | データベース設計 | Taskテーブルのスキーマを設計し、ER図を作成する | IN_PROGRESS | システム日付 | システム日付 | 50 |
| 3 | フロントエンド実装 | Todoリスト画面のUIを実装する | TODO | システム日付 | システム日付 | 0 |
